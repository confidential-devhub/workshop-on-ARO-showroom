= Sign an existing pod

xref:configure-trustee.adoc#trustee-cisvp[Back to signature verification policy]

1. Log into podman. This is necessary as `cosign` will push signatures into your repo.

2. Install `cosign`
+
[source,sh,role=execute]
----
mkdir -p cosign
cd cosign

curl -O -L "https://github.com/sigstore/cosign/releases/latest/download/cosign-linux-amd64"

mv cosign-linux-amd64 cosign
chmod +x cosign
----

3. Create a cosign keypair
+
[source,sh,role=execute]
----
./cosign generate-key-pair
----

4. Pull an existing image or create it yourself. Here we will pull it
+
[source,sh,role=execute]
----
SOURCE_IMAGE=quay.io/confidential-devhub/signed-hello-openshift
podman pull $SOURCE_IMAGE
----

5. Optional: If you don't have access to the source image repository, make a copy into your own repo by pushing it. This is needed because cosign pushes the signature into the repo. If you don’t have access to that repo (like in this example) you won’t be able to push the signature.
+
[source,sh,role=execute]
----
DEST_IMAGE=write/your/repo:here

podman tag $SOURCE_IMAGE $DEST_IMAGE

podman push $DEST_IMAGE
----

6. Delete existing signature, if there is
+
[source,sh,role=execute]
----
./cosign clean $DEST_IMAGE
----

7. Sign the new image
+
[source,sh,role=execute]
----
./cosign sign --key cosign.key $DEST_IMAGE
----

8. Verify the signature is there
+
[source,sh,role=execute]
----
./cosign verify --key cosign.pub $DEST_IMAGE
----

xref:configure-trustee.adoc#trustee-cisvp[Back to signature verification policy]